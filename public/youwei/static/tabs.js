var all = {
    "code": 0,
    "errMsg": "",
    "data": {
      "index": [
        {
          "pid": "178",
          "name": "日经225",
          "tag": "index",
          "memo": "日本东京",
          "code": "jp",
          "pc": "-218.00",
          "pcp": "-0.56%",
          "last": 38419.5,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "40820",
          "name": "上证指数",
          "tag": "index",
          "memo": "上海",
          "code": "cn",
          "pc": "+11.83",
          "pcp": "+0.36%",
          "last": 3342.552,
          "time": "2024-11-18",
          "isOpen": false
        },
        {
          "pid": "942630",
          "name": "深证成指",
          "tag": "index",
          "memo": "深圳",
          "code": "cn",
          "pc": "-288.81",
          "pcp": "-2.62%",
          "last": 10748.97,
          "time": "2024-11-15",
          "isOpen": false
        },
        {
          "pid": "945512",
          "name": "创业板指",
          "tag": "index",
          "memo": "深圳",
          "code": "cn",
          "pc": "-91.34",
          "pcp": "-3.91%",
          "last": 2243.62,
          "time": "2024-11-15",
          "isOpen": false
        },
        {
          "pid": "28930",
          "name": "富时中国A50",
          "tag": "index",
          "memo": "上海",
          "code": "cn",
          "pc": "+49.07",
          "pcp": "+0.37%",
          "last": 13420.21,
          "time": "2024-11-18",
          "isOpen": false
        },
        {
          "pid": "179",
          "name": "香港恒生",
          "tag": "index",
          "memo": "香港",
          "code": "hk",
          "pc": "+162.66",
          "pcp": "+0.84%",
          "last": 19589,
          "time": "2024-11-18",
          "isOpen": false
        },
        {
          "pid": "169",
          "name": "道琼斯",
          "tag": "index",
          "memo": "纽约",
          "code": "us",
          "pc": "+20.28",
          "pcp": "+0.05%",
          "last": 43978.47,
          "time": "2024-11-14",
          "isOpen": false
        },
        {
          "pid": "166",
          "name": "标普500",
          "tag": "index",
          "memo": "纽约",
          "code": "us",
          "pc": "-78.60",
          "pcp": "-1.32",
          "last": 5870.6,
          "time": "2024-11-16",
          "isOpen": false
        },
        {
          "pid": "14958",
          "name": "纳斯达克",
          "tag": "index",
          "memo": "纳斯达克",
          "code": "us",
          "pc": "-427.53",
          "pcp": "-2.24",
          "last": 18680.12,
          "time": "2024-11-16",
          "isOpen": false
        },
        {
          "pid": "172",
          "name": "德国DAX30",
          "tag": "index",
          "memo": "法兰克福",
          "code": "ger",
          "pc": "-25.48",
          "pcp": "-0.13%",
          "last": 19194.55,
          "time": "2024-11-18",
          "isOpen": false
        }
      ],
      "indexfutrue": [
        {
          "pid": "44336",
          "name": "VIX恐慌期货",
          "tag": "indexfutrue",
          "memo": "期货",
          "code": "us",
          "pc": "+0.70",
          "pcp": "+4.34%",
          "last": 16.84,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "44486",
          "name": "富时中国A50期货",
          "tag": "indexfutrue",
          "memo": "期货",
          "code": "us",
          "pc": "+95.0",
          "pcp": "+0.71%",
          "last": 13413,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "8873",
          "name": "道琼斯30期货",
          "tag": "indexfutrue",
          "memo": "期货",
          "code": "us",
          "pc": "-70.00",
          "pcp": "-0.16%",
          "last": 43498,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "8839",
          "name": "美国标普500期货",
          "tag": "indexfutrue",
          "memo": "期货",
          "code": "us",
          "pc": "0.00",
          "pcp": "0.00%",
          "last": 5896.5,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "8874",
          "name": "纳斯达克100期货",
          "tag": "indexfutrue",
          "memo": "期货",
          "code": "us",
          "pc": "+42.00",
          "pcp": "+0.20%",
          "last": 20535.75,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "8859",
          "name": "日经225期货",
          "tag": "indexfutrue",
          "memo": "期货",
          "code": "us",
          "pc": "+145.0",
          "pcp": "+0.38%",
          "last": 38205,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "8984",
          "name": "香港恒生期货",
          "tag": "indexfutrue",
          "memo": "期货",
          "code": "us",
          "pc": "+173.0",
          "pcp": "+0.89%",
          "last": 19621,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "8982",
          "name": "中国H股期货",
          "tag": "indexfutrue",
          "memo": "期货",
          "code": "us",
          "pc": "-200.0",
          "pcp": "-2.65",
          "last": 7350,
          "time": "2024-11-06",
          "isOpen": true
        },
        {
          "pid": "8897",
          "name": "新加坡MSCI期货",
          "tag": "indexfutrue",
          "memo": "期货",
          "code": "us",
          "pc": "+0.50",
          "pcp": "+0.14%",
          "last": 365.05,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "104392",
          "name": "新交所MSCI台湾期货",
          "tag": "indexfutrue",
          "memo": "期货",
          "code": "us",
          "pc": "-4.75",
          "pcp": "-0.25%",
          "last": 1879.5,
          "time": "2024-11-18",
          "isOpen": true
        }
      ],
      "futrue": [
        {
          "pid": 999999999,
          "name": "波罗的海BDI指数",
          "tag": "futrue",
          "memo": "BDI指数",
          "code": "BDI",
          "pc": "-29.00",
          "pcp": "-1.62%",
          "last": 1756,
          "time": "2024-11-19",
          "isOpen": 1
        },
        {
          "pid": "8849",
          "name": "WTI原油期货",
          "tag": "futrue",
          "memo": "能源",
          "code": "us",
          "pc": "+0.58",
          "pcp": "+0.87%",
          "last": 67.5,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "8833",
          "name": "伦敦布伦特原油期货",
          "tag": "futrue",
          "memo": "能源",
          "code": "us",
          "pc": "+0.63",
          "pcp": "+0.89%",
          "last": 71.67,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "8830",
          "name": "黄金期货",
          "tag": "futrue",
          "memo": "金属",
          "code": "us",
          "pc": "+26.10",
          "pcp": "+1.02%",
          "last": 2596.2,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "8836",
          "name": "白银期货",
          "tag": "futrue",
          "memo": "金属",
          "code": "us",
          "pc": "+0.365",
          "pcp": "+1.20%",
          "last": 30.797,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "8831",
          "name": "铜期货",
          "tag": "futrue",
          "memo": "金属",
          "code": "us",
          "pc": "+0.0220",
          "pcp": "+0.54%",
          "last": 4.0865,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "49768",
          "name": "伦敦铝期货",
          "tag": "futrue",
          "memo": "金属期货",
          "code": "us",
          "pc": "-42.00",
          "pcp": "-1.58%",
          "last": 2615,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "8916",
          "name": "美国大豆期货",
          "tag": "futrue",
          "memo": "农业",
          "code": "us",
          "pc": "-2.75",
          "pcp": "-0.28%",
          "last": 994.25,
          "time": "2024-11-18",
          "isOpen": true
        }
      ],
      "bitcoin": [
        {
          "pid": "1057391",
          "name": "BTC/比特币",
          "tag": "bitcoin",
          "memo": "加密货币",
          "code": "us",
          "pc": "+710.0",
          "pcp": "+0.78%",
          "last": 91768.8,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "1061443",
          "name": "ETH/以太坊",
          "tag": "bitcoin",
          "memo": "加密货币",
          "code": "us",
          "pc": "-29.04",
          "pcp": "-0.92%",
          "last": 3111.03,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "1061477",
          "name": "DOGE/狗狗币",
          "tag": "bitcoin",
          "memo": "加密货币",
          "code": "us",
          "pc": "+0.005852",
          "pcp": "+1.59%",
          "last": 0.373033,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "1061445",
          "name": "LTC/莱特币",
          "tag": "bitcoin",
          "memo": "加密货币",
          "code": "us",
          "pc": "+0.715",
          "pcp": "+0.79%",
          "last": 91.009,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "1061450",
          "name": "TRX/波场币",
          "tag": "bitcoin",
          "memo": "加密货币",
          "code": "us",
          "pc": "+0.006122",
          "pcp": "+3.11%",
          "last": 0.202898,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "1061448",
          "name": "BNB/币安币",
          "tag": "bitcoin",
          "memo": "加密货币",
          "code": "us",
          "pc": "-13.12",
          "pcp": "-2.07%",
          "last": 622.18,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "1094137",
          "name": "HT/火币积分",
          "tag": "bitcoin",
          "memo": "加密货币",
          "code": "us",
          "pc": "+0.022",
          "pcp": "+3.63%",
          "last": 0.627,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "1057392",
          "name": "XRP/瑞波币",
          "tag": "bitcoin",
          "memo": "加密货币",
          "code": "us",
          "pc": "+0.0651",
          "pcp": "+6.08%",
          "last": 1.137,
          "time": "2024-11-18",
          "isOpen": true
        }
      ],
      "currency": [
        {
          "pid": "8827",
          "name": "美元指数",
          "tag": "currency",
          "memo": "货币",
          "code": "us",
          "pc": "+0.024",
          "pcp": "+0.02%",
          "last": 106.639,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "2111",
          "name": "美元/人民币",
          "tag": "currency",
          "memo": "货币",
          "code": "us",
          "pc": "+0.0129",
          "pcp": "+0.18%",
          "last": 7.2438,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "961728",
          "name": "美元/离岸人民币",
          "tag": "currency",
          "memo": "货币",
          "code": "us",
          "pc": "+0.0099",
          "pcp": "+0.14%",
          "last": 7.2474,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "1817",
          "name": "港币/人民币",
          "tag": "currency",
          "memo": "货币",
          "code": "us",
          "pc": "+0.0018",
          "pcp": "+0.19%",
          "last": 0.9306,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "1893",
          "name": "日元/人民币",
          "tag": "currency",
          "memo": "货币",
          "code": "us",
          "pc": "-0.00020",
          "pcp": "-0.43%",
          "last": 0.0466643905,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "1623",
          "name": "欧元/人民币",
          "tag": "currency",
          "memo": "货币",
          "code": "us",
          "pc": "+0.0197",
          "pcp": "+0.26%",
          "last": 7.6418,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "155",
          "name": "美元/港币",
          "tag": "currency",
          "memo": "货币",
          "code": "us",
          "pc": "-0.0017",
          "pcp": "-0.02%",
          "last": 7.78425,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "2124",
          "name": "美元/欧元",
          "tag": "currency",
          "memo": "货币",
          "code": "us",
          "pc": "-0.0017",
          "pcp": "-0.18%",
          "last": 0.947935,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "2126",
          "name": "美元/英镑",
          "tag": "currency",
          "memo": "货币",
          "code": "us",
          "pc": "+0.0001",
          "pcp": "+0.01%",
          "last": 0.79215,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "3",
          "name": "美元/日元",
          "tag": "currency",
          "memo": "货币",
          "code": "us",
          "pc": "+0.91",
          "pcp": "+0.59%",
          "last": 155.25,
          "time": "2024-11-18",
          "isOpen": true
        }
      ],
      "debt": [
        {
          "pid": "29227",
          "name": "中国10年期国债",
          "tag": "debt",
          "memo": "债券收益率",
          "code": "us",
          "pc": "+0.015",
          "pcp": "+0.72%",
          "last": 2.103,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "29234",
          "name": "中国5年期国债",
          "tag": "debt",
          "memo": "债券收益率",
          "code": "us",
          "pc": "-0.020",
          "pcp": "-1.16%",
          "last": 1.7,
          "time": "2024-11-15",
          "isOpen": true
        },
        {
          "pid": "29232",
          "name": "中国2年期国债",
          "tag": "debt",
          "memo": "债券收益率",
          "code": "us",
          "pc": "-0.006",
          "pcp": "-0.43%",
          "last": 1.402,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "23705",
          "name": "美国10年期国债",
          "tag": "debt",
          "memo": "债券收益率",
          "code": "us",
          "pc": "+0.057",
          "pcp": "+1.29%",
          "last": 4.484,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "23703",
          "name": "美国5年期国债",
          "tag": "debt",
          "memo": "债券收益率",
          "code": "us",
          "pc": "+0.032",
          "pcp": "+0.75%",
          "last": 4.328,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "23701",
          "name": "美国2年期国债",
          "tag": "debt",
          "memo": "债券收益率",
          "code": "us",
          "pc": "+0.019",
          "pcp": "+0.45%",
          "last": 4.32,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "23901",
          "name": "日本10年期国债",
          "tag": "debt",
          "memo": "债券收益率",
          "code": "us",
          "pc": "-0.002",
          "pcp": "-0.19%",
          "last": 1.069,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "23896",
          "name": "日本5年期国债",
          "tag": "debt",
          "memo": "债券收益率",
          "code": "us",
          "pc": "0.000",
          "pcp": "0.00%",
          "last": 0.706,
          "time": "2024-11-18",
          "isOpen": true
        },
        {
          "pid": "23893",
          "name": "日本2年期国债",
          "tag": "debt",
          "memo": "债券收益率",
          "code": "us",
          "pc": "+0.001",
          "pcp": "+0.18%",
          "last": 0.553,
          "time": "2024-11-18",
          "isOpen": true
        }
      ]
    }
  }
var Tool = {
    data:[],
    config:[{tag:'indexfutrue', wrap:'#tab-idx1'},{tag:'currency', wrap:'#tab-idx2'}],
    init:function(options){
        this.config = options;
        this.getServerData();
    },
    resetConfig:function(tag, idx){
        if(this.config[idx] != undefined){
            this.config[idx].tag = tag;
        }
        if(this.data.length == 0){
            this.getServerData();
        }else{
            this.makeHtml(this.data);
        }
    },
    template:function(data, oldData){
        var html = "";
        for(var i =0; i< data.length; i++){
            var timeClass = this.getTimeClass(data[i].isOpen);
            var numClass = this.getNumClass(data[i].pc);
            var bgClass = this.getBgClass(data[i].last, oldData[i].last);
            html += '<div class="box-row"><div class="box-header">' +
                '<div>'+ data[i].name +'</div><div class="'+ bgClass +'">' + data[i].last +'</div></div>' +
                '<div class="box-body"> <div class="'+ timeClass +'">' + data[i].time +'</div> ' +
                '<div style="'+ numClass +'">' + data[i].pc +'('+ data[i].pcp +')</div> </div></div>';
        }
        return html;
    },
    getBgClass:function(newLast, oldLast){
        var bgClass = "";
        if(parseFloat(newLast) > parseFloat(oldLast)){
            bgClass = "redBg"
        }else if(parseFloat(newLast) < parseFloat(oldLast)){
            bgClass = "greenBg"
        }
        return bgClass;
    },

    getTimeClass:function(isOpen){
        var timeClass = "box-row-red";
        if(isOpen == true){
            timeClass = "box-row-green";
        }
        return timeClass;
    },
    getNumClass:function(num){
        var first = (num+"").substring(0,1);
        var style = "color:gray;";
        if(first == "+"){
            style = "color:red;";
        }else if(first == "-"){
            style = "color:green;";
        }
        return style;
    },

    makeHtml:function(data){
        var config = this.config;
        for(var i =0; i< config.length; i++){
            var ele = config[i].wrap;
            var key = config[i].tag;

            var oldData = (this.data.length == 0) ? data : this.data;
            var html = this.template(data[key], oldData[key]);
            $(ele).empty().html(html);
        }
        this.data = data;
    },

    getServerData:function(){
        var that = this;
        // $.get("https://upsort.com/all", function(resp){
        //     that.makeHtml(resp.data);
        //     that.heartBeat();
        // })

                    that.makeHtml(all.data);
            that.heartBeat();
    },

    heartBeat:function(){
        var that = this;
        setTimeout(function(){
            that.getServerData();
        }, 5000);
    }
};